GOIM - GoInMemory
=====

Overview
------------

GOIM is an implementation of concurrent key-value storage where value can be a string, 
array of strings or a map of strings. Supports per-key TTL.
 
Network communication is happening over TLS. GOIM uses it's own binary protocol which is synchronous, 
which means that two requests can't be executed simultaneously within one connection.  

Installation
------------
Set `GOPATH` to root directory and execute.
Run `dep ensure` in `src/goim` directory to install packages.

Execute `go install goim/server/cmd/server` in the root directory to get a server executable.

Execute `go install goim/auth/cmd/user_manager` in the root directory to get a user manager executable.

Execute `go install goim/client/cmd/benchmark` in the root directory to get a benchmark executable.

Usage
------------
Executable `user_manager` is a tool which helps to manage users for GOIM. Execute it with `-path /path/to/users.json` option to enter 
shell mode to manage users. Use `help` to see a list of available commands.
Example `user_manager -path ./example/users.json`

Start `server` with the following command line options
 * `-users`  path to users file generated by user_manager tool, example `example/users.json`
 * `-cert` path to ssl cert file, example `example/server.crt`
 * `-key` path to ssl key file, example `exapmle/server.key`
 * `-address` network address of server, example `localhost:23456`
 
 Example: 
`server -cert ./example/server.crt -key ./example/server.key -users ./example/users.json -address localhost:5432`

Start `benchmark` with the following command line options
 * `-username`  username, example `kiryl`
 * `-password` password, example `test`
 * `-address` network address of server, example `localhost:5432`
 * `-connections` count of parallel connections, example `100`
 * `-duration` duration of test in seconds, example `5`
 
 Example: 
`benchmark -username kiryl -password test -address localhost:5432 -connections 100 -duration 5`

API
------------

API supports following calls

* Authenticate(username *string, password *string) (status int32)
* GetKeys
* GetStr
* SetStr
* GetArr
* SetArr
* GetArrItem
* SetArrItem
* GetDict
* SetDict
* GetDictItem
* SetDictItem
* RemoveEntry

Within each set operation `TTL` should be passed.
When updating `TTL = 0` means that expiration should not be updated, when creating has the same meaning as -1.
`TTL = -1` means that there is no expiration for a key.
`TTL > 0` represents TTL in milliseconds.

Within each response key expiration datetime is returned.
`Expires = -1` means that there was no result found for this key.
`Expires = 0` means that there is no expiration for this key
`Expires > 0` is an expiration datetime represented in unixtimestamp format in milliseconds.

Within each response status is returned. It might have the following values.

| Code | Description |
| ------ | ------ |
| 0    | Success  |
| 1001 | Wrong credentials |
| 1002 | Not authenticated |
| 1003 | Internal error |

More details on accepting and returning parameters find in `goim/rpc` package. 

Package Format
------------
Packages have custom binary format. 
Package has the following memory layout:

`package length (4 bytes, big endian), model id (4 bytes, big endian), fields`

Fields don't have their own type definition stored. Basing on model id deserializer should determine what fields are there. 

For more look into `goim/rpc` package.